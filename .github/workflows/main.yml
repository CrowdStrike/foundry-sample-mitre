name: Sample CI
on: [ push, pull_request ]

jobs:
  build:
    strategy:
      matrix:
        path:
          - shared/mitre-vue
          - ui/extensions/remediations
          - ui/pages/chart-vue
    name: Build and Test (${{ matrix.path }})
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v5
      - name: Use Node 22
        uses: actions/setup-node@v4
        with:
          node-version: 22
          cache: 'yarn'
          cache-dependency-path: |
            yarn.lock
            ${{ matrix.path }}/yarn.lock
      - name: Enable Corepack for Yarn
        run: |
          corepack enable
          corepack prepare yarn@stable --activate
      - name: Install dependencies in ${{ matrix.path }}
        working-directory: ${{ matrix.path }}
        run: yarn install --immutable
      - name: Build Vue app in ${{ matrix.path }}
        if: matrix.path != 'shared/mitre-vue'
        working-directory: ${{ matrix.path }}
        run: yarn build
      - name: Test the Vue app in ${{ matrix.path }}
        working-directory: ${{ matrix.path }}
        run: yarn test:unit
